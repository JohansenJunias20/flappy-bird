<!DOCTYPE html>
<html>

<head>
    <script src="libraries/phaser.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
</head>

<body>
    <script>
    </script>
    <script>
        var config = {
            type: Phaser.AUTO,
            width: 300,
            height: 600,
            parent: 'phaser-example',
            physics: {
                default: 'arcade',
                arcade: {
                    debug: true,
                    gravity: { y: 650 }
                }
            },
            scene: {
                preload: preload,
                create: create,
                update:update
            }
        };
        var game = new Phaser.Game(config);
        function preload() {

            //  You can fill the preloader with as many assets as your game requires

            //  Here we are loading an image. The first parameter is the unique
            //  string by which we'll identify the image later in our code.

            //  The second parameter is the URL of the image (relative)
            this.load.image('flyer', 'assets/bird.png');
            baseTexture = this.load.image('base', 'assets/base.png');
            this.load.image('pipe', 'assets/pipe-green.png');

        }
        var baseTexture;
        var bird;
        var base;
        var pipes;
        function create() {
            const ref = this;
            // menambah sprite pada canvas dengan physics
            base = this.physics.add.sprite(null, null, 'base');
            base.depth = 5
            bird = this.physics.add.sprite(this.cameras.main.width/4, this.cameras.main.height/2-base.height, 'flyer');
            pipes = this.physics.add.group({
                key: 'pipe',
                repeat: 3,
                setXY:{
                    x:ref.cameras.main.width/2,
                    y:ref.cameras.main.height,
                    stepX:ref.cameras.main.width/2
                }
            })
            pipes.children.iterate(function (child) {
                child.body.allowGravity = false
                child.setImmovable(true)
                child.setVelocityX(-50) 
                return child
                //child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
        
            });


            bird.body.width = bird.width / 1.5
            bird.body.offset.x = (bird.width - bird.body.width) / 2
            //bird.body.offset.y = bird.height/2
            //this.add.sprite(x,y,keyImage) menambah
            base.setPosition(base.width / 2, this.cameras.main.height - base.height / 2)
            base.setImmovable(true)
            base.body.allowGravity = false
            bird.setCollideWorldBounds(true)
            
            this.physics.add.collider(bird, base)
            cursors = this.input.keyboard.createCursorKeys();
        }
        var spacePressed =false;
        function update() {

            // nothing required here
            if(cursors.space.isDown&&!spacePressed){
                spacePressed= true
                bird.setVelocityY(-350)

            }

            if(spacePressed&&cursors.space.isUp){
                spacePressed = false
            }
        }


    </script>
</body>

</html>